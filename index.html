<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <title>A cross-platform package manager</title>

    <link rel="shortcut icon" href="images/favicon.ico" type="image/vnd.microsoft.icon">

    <meta name="description" content="Presentation slides for PyCon.PL 2015">
    <meta name="author" content="Mateusz Paprocki">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="reveal.js/css/reveal.css">
    <link rel="stylesheet" href="reveal.js/css/theme/black.css" id="theme">

    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="reveal.js/lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal.js/css/print/pdf.css' : 'reveal.js/css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>

    <!--[if lt IE 9]>
    <script src="reveal.js/lib/js/html5shiv.js"></script>
    <![endif]-->

    <style>
      #continuum-logo {
        background-image: url(images/logo-white.svg);
        background-position: center;
        background-size: contain;
        background-repeat: no-repeat;
        width: 100%;
        height: 50px;
      }
      .reveal pre {
        font-size: 0.45em;
      }
    </style>
  </head>

  <body>
    <div class="reveal">
      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">
        <section data-background="images/continuum.jpg">
          <h1>Conda</h1>
          <h3>A cross-platform package manager</h3>
          <p>
            <small>
              Created by <a href="http://mateuszpaprocki.pl">Mateusz Paprocki</a> / <a href="http://github.com/mattpap">@mattpap</a>
              <br>
            </small>
          </p>
          <a href="http://www.continuum.io">
            <div id="continuum-logo"></div>
          </a>
        </section>

        <section>
          <h3>The history</h3>
          <img src="images/history1.png" width="450" height="450"></img>
          <img src="images/history2.png" width="450" height="450"></img>
        </section>

        <section>
          <h3>Two sides</h3>
          Instaling Building
          User Developer
        </section>

        <section>
          <h3>Installing</h3>
          <ul>
            <li>setup.py install</li>
            <li>easy_install</li>
            <li>pip</li>
            <li>apt-get</li>
            <li>rpm</li>
            <li>emerge</li>
            <li>homebrew</li>
            <li>...</li>
          </ul>
        </section>

        <section>
          <h3>setup.py install</h3>
          <ul>
            <li>fine if it's pure Python, not so much if it isn't</li>
            <li>you have to have compiers installed</li>
            <pre>
distutils.errors.DistutilsError: Setup script existed with
error: command 'gcc' failed with exit status 1
            </pre>
          </ul>
        </section>

        <section>
          <h3>Example: installing NumPy</h3>
          <pre>
$ git clone git@github.com:numpy/numpy.git; cd numpy
$ python setup.py install
Running from numpy source directory.
Cythonizing sources
Processing numpy/random/mtrand/mtrand.pyx
Traceback (most recent call last):
  File "<string>", line 1, in <module>
ImportError: No module named Cython.Compiler.Main
Traceback (most recent call last):
  File "/home/mateusz/repos/numpy/tools/cythonize.py", line 199, in <module>
    main()
  File "/home/mateusz/repos/numpy/tools/cythonize.py", line 195, in main
    find_process_files(root_dir)
  File "/home/mateusz/repos/numpy/tools/cythonize.py", line 187, in find_process_files
    process(cur_dir, fromfile, tofile, function, hash_db)
  File "/home/mateusz/repos/numpy/tools/cythonize.py", line 161, in process
    processor_function(fromfile, tofile)
  File "/home/mateusz/repos/numpy/tools/cythonize.py", line 81, in process_pyx
    raise Exception('Cython failed')
Exception: Cython failed
Traceback (most recent call last):
  File "setup.py", line 264, in <module>
    setup_package()
  File "setup.py", line 252, in setup_package
    generate_cython()
  File "setup.py", line 199, in generate_cython
    raise RuntimeError("Running cythonize failed!")
RuntimeError: Running cythonize failed!
          </pre>
        </section>

        <section>
          <h3>setup.py install</h3>
          You are your own package manager.
        </section>

        <section>
          <h3>pip</h3>
          <ul>
            <li>only works with Python</li>
            <li>not so great for scientific packages that depend on native libraries</li>
            <li>try installing h5py if you don't have HDF5</li>
          </ul>
        </section>

        <section>
          <h3></h3>
          You are a "self integrator"
        </section>

        <section>
          <h3></h3>
          Package maintainers hate having packages that no one can install
        </section>

        <section>
          <h3>What about wheels?</h3>
          <ul>
            <li>Python package specific</li>
            <ul>
              <li>can't build wheels for native libraries</li>
              <li>can't make a wheel for Python itself</li>
            </ul>
            <li>still doesn't address the problem that some metadata is only in the package itself</li>
            <li>you are still a "self integrator"</li>
          </ul>
        </section>

        <section>
          <h3>System packaging solutions</h3>
          Linux
          apt-get (dpkg)
          yum (rpm)
          OSX
          macports, homebrew, fink
          Windows
          chocolatey
          npackd
          Cross-platform
          conda
        </section>

        <section>
          <h3>Conda</h3>
          <ul>
            <li>system level package manager (Python agnostic)</li>
            <li>Python, HDF5 and h5py are all conda packages</li>
            <li>cross-platform (works on Windows, OSX and Linux)</li>
            <li>doesn't require administrator privileges (sudo)</li>
            <li>installs bineries (no more compiler woes)</li>
            <li>metadata stored separately in the repository index</li>
            <li>uses a SAT solver to resolve dependencies before package are installed</li>
          </ul>
        </section>

        <section>
          <h3>Basic conda usage</h3>
          <ul>
            <li>Install a package - <pre>conda install sympy</pre></li>
            <li>List all installed packages - <pre>conda list</pre></li>
            <li>Search for packages - <pre>conda search numpy</pre></li>
            <li>Create a new environment - <pre>conda create -n py35 python=3.5</pre></li>
            <li>Remove a package - <pre>conda remove sympy</pre></li>
            <li>Get help - <pre>conda install --help</pre></li>
          </ul>
        </section>

        <section>
          <h3>Advanced conda usage</h3>
          <ul>
            <li>Insall a package in an environment - <pre>conda install -n py35 sympy</pre></li>
            <li>Update all packages - <pre>conda update --all</pre></li>
            <li>Export list of packages - <pre>conda list --export pkgs.txt</pre></li>
            <li>Install packages from an export - <pre>conda install --file pkgs.txt</pre></li>
            <li>See package history - <pre>conda list --revisions</pre></li>
            <li>Revert to a specific revision - <pre>conda install --revision 23</pre></li>
            <li>Remove unsused packages and tarballs - <pre>conda clean -pt</pre></li>
          </ul>
        </section>

        <section>
          <h3>What is a conda package?</h3>
          a tarball (tar.bz2) with the files form a software package and some metadata
          /lib
          /include
          /bin
          /man
          /info
          Files are not Python specific
          Any kind of program at all can be a conda package
          Metadata is static
        </section>

        <section>
          <h3>Package specification</h3>
          <img src="images/pkgspec.png"></img>
        </section>

        <section>
          <h3>Python agnostic</h3>
          A conda package can be anything:
          <ul>
            <li>pure Python packages</li>
            <li>Python package with C extensions</li>
            <li>Python itself</li>
            <li>C/C++/Fortran etc. libraries (GDAL, netCDF4, dynd, ...)</li>
            <li>R</li>
            <li>node.js</li>
            <li>Perl</li>
          </ul>
        </section>

        <section>
          <h3>Installation</h3>
          <pre>conda install sympy</pre>
          <ul>
            <li>the tarball is unarchived in the pkgs directory</li>
            <li>files are hard-linked* to the install path</li>
            <li>shebang lines and other instances of a place-holder prefix are replaced with the install prefix</li>
            <li>the metadata is update, so that conda kowns that it is installed</li>
            <li>post-link script is run (these are rare)</li>
          </ul>
          And that's it.
        </section>

        <section>
          <h3>Environments</h3>
          <pre>conda create -n py35 python=3.5</pre>
          <ul>
            <li>environments are simple: just link the pckage to a different directory</li>
            <li>hard-links are very cheap and very fast</li>
            <li>conda environments are completely independent installations of everything</li>
              <ul>
                <li>no fiddling iwht PYTHONPATH or symlinking site-packages</li>
              </ul>
            <li>"activating" an environment jsut means chaning your PATH, so that its bin/ or Scripts/ comes first</li>
              <ul>
                <li>Unix: source activate py35</li>
                <li>Windows: activate py35</li>
              </ul>
          </ul>
        </section>

        <section>
          <h3>Environments</h3>
          Uses:
          <ul>
            <li>testing (Python 2.6, 2.7, 3.3, 3.4, 3.5, ...)</li>
            <li>development</li>
            <li>trying new package from PyPI</li>
            <li>separating deployed apps with different dependency needs</li>
            <li>trying new versions of Python</li>
            <li>reproducible science</li>
          </ul>
        </section>

        <section>
          <h3>Building</h3>
        </section>

        <section>
          <h3>Conda Recipes</h3>
          <pre>conda build path/to/recipe</pre>
          <ul>
            <li>meta.yaml contains metadata</li>
            <li>build.sh is the build script for Unix and bld.bat is the build script for Windows</li>
          </ul>
        </section>

        <section>
          <h3>Example meta.yaml</h3>
        </section>

        <section>
          <h3></h3>
          Lots more:
          <ul>
            <li>command line entry points</li>
            <li>fine-grained control over conda's relocation lgic</li>
            <li>inequalites for version of dependeices (like &gt;=1.2, &lt;2.0)</li>
            <li>"Preprocessing selectors" allow using the same meta.yaml for many platforms</li>
            <li>see <a href="http://conda.pydata.org/docs/build.html"></a> for full documentation</li>
            <li>conda build is only oa convenient wrapper</li>
            <li>you can also build packages manually just by following the package specification</li>
            <li>http://conda.pydata.org/docs/spec.html</li>
          </ul>
        </section>

        <section>
          <h3>Sharing</h3>
        </section>

        <section>
          <h3>Self hosting</h3>
          <pre>conda index directory/linux-64</pre>
          <ul>
            <li>you can self-host</li>
            <li>store packaes in a direcotry by platform (osx-64, linux-32, linux-64, win-32, win-64)</li>
            <li>run conda index on that direcotyr to generate the repodata.json</li>
            <li>serve this up or use a file:// URL as a channel</li>
            <li>binstar is just a very convenient hosted wrapper around conda index</li>
          </ul>
        </section>

        <section>
          <h3>Supported platforms</h3>
          <img src="images/linux.svg" width="300" height="300"></img>
          <img src="images/osx.svg" width="300" height="300"></img>
          <img src="images/windows.svg" width="300" height="300"></img>
        </section>

        <section>
          <h3>Final words</h3>
          <ul>
            <li>conda is completely open source (BSD)</li>
            <li>https://github.com/conda/conda</li>
            <li>mailing list conda@continuum.io</li>
          </ul>
        </section>

        <section>
          <h3>Creating a new environment</h3>
          <pre>
$ conda create -n py35 python=3.5
Fetching package metadata: ....
Solving package specifications: .
Package plan for installation in environment /home/mateusz/miniconda/envs/py35:

The following packages will be downloaded:

    package                    |            build
    ---------------------------|-----------------
    xz-5.0.5                   |                0         504 KB
    python-3.5.0               |                0        16.6 MB
    setuptools-18.4            |           py35_0         345 KB
    wheel-0.26.0               |           py35_1          77 KB
    pip-7.1.2                  |           py35_0         1.4 MB
    ------------------------------------------------------------
                                           Total:        19.0 MB

The following NEW packages will be INSTALLED:

    openssl:    1.0.1k-1
    pip:        7.1.2-py35_0
    python:     3.5.0-0
    readline:   6.2-2
    setuptools: 18.4-py35_0
    sqlite:     3.8.4.1-1
    tk:         8.5.18-0
    wheel:      0.26.0-py35_1
    xz:         5.0.5-0
    zlib:       1.2.8-0
          </pre>
        </section>

        <section>
          <pre>
$ conda info
Current conda install:

             platform : linux-64
        conda version : 3.16.0
  conda-build version : not installed
       python version : 2.7.10.final.0
     requests version : 2.7.0
     root environment : /home/mateusz/miniconda  (writable)
  default environment : /home/mateusz/miniconda
     envs directories : /home/mateusz/miniconda/envs
        package cache : /home/mateusz/miniconda/pkgs
         channel URLs : https://repo.continuum.io/pkgs/free/linux-64/
                        https://repo.continuum.io/pkgs/free/noarch/
                        https://repo.continuum.io/pkgs/pro/linux-64/
                        https://repo.continuum.io/pkgs/pro/noarch/
          config file : None
    is foreign system : False
            </pre>
        </section>
      </div>
    </div>

    <script src="reveal.js/lib/js/head.min.js"></script>
    <script src="reveal.js/js/reveal.js"></script>

    <script>
      Reveal.initialize({
        controls: true,
        progress: true,
        slideNumber: true,
        history: true,
        center: true,
        transition: 'none',
        dependencies: [
          { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'reveal.js/plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
          { src: 'reveal.js/plugin/notes/notes.js', async: true }
        ]
      });
    </script>
  </body>
</html>
